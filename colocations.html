<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Liste des colocations - COLLOCOV">
    <title>Liste des colocations - COLLOCOV</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="dist/css/main.css">
    <style>
        .leaflet-container {
            font-family: 'Inter', sans-serif;
        }
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            font-family: 'Inter', sans-serif;
        }
        .leaflet-popup-content {
            margin: 0.75rem;
            font-size: 0.9rem;
        }
        .leaflet-control-zoom {
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            border-radius: 8px;
            overflow: hidden;
        }
        .leaflet-control-zoom a {
            background-color: #10b981;
            color: #ffffff;
            border: none;
            width: 32px;
            height: 32px;
            line-height: 32px;
            font-size: 1.2rem;
            font-weight: 600;
            transition: background-color 0.2s ease;
        }
        .leaflet-control-zoom a:hover {
            background-color: #059669;
        }
    </style>
</head>
<body>
    <!-- Header Navigation -->
    <header class="header">
        <nav class="nav container">
            <div class="nav__logo">
                <a href="index.html" class="logo-link">/COLLOCOV</a>
            </div>
            <ul class="nav__menu">
                <li class="nav__item"><a href="index.html" class="nav__link">Acceuil</a></li>
                <li class="nav__item"><a href="contact.html" class="nav__link">Contact</a></li>
                <li class="nav__item"><a href="urgence.html" class="nav__link">urgence</a></li>
            </ul>
            <div class="nav__actions">
                <div class="nav__profile">
                    <button class="nav__profile-btn" id="profileBtn" aria-label="Menu profil">
                        <img src="https://ui-avatars.com/api/?name=User&background=3B82F6&color=fff&size=128" alt="Profile" class="nav__profile-img" id="profileImg">
                    </button>
                    <div class="nav__dropdown" id="profileDropdown">
                        <a href="#" class="nav__dropdown-item" onclick="window.location.href='profile.html'; return false;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            My profile
                        </a>
                        <div class="nav__dropdown-divider"></div>
                        <div class="nav__dropdown-user" id="dropdownUserName"></div>
                        <button class="nav__dropdown-item nav__dropdown-item--logout" onclick="logoutUser()">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            Déconnexion
                        </button>
                    </div>
                </div>
            </div>
            <button class="nav__toggle" aria-label="Toggle menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main">
        <div class="dashboard-layout">
            <!-- Sidebar Navigation -->
            <aside class="sidebar">
                <div class="sidebar__header">
                    <div class="sidebar__user">
                        <img src="https://ui-avatars.com/api/?name=User&background=3B82F6&color=fff&size=128" alt="Profile" class="sidebar__user-img" id="sidebarProfileImg">
                        <span class="sidebar__user-name" id="sidebarUserName">Utilisateur</span>
                    </div>
                    <div class="sidebar__icons">
                        <button class="sidebar__icon-btn" id="messagesBtn" aria-label="Messages" onclick="window.location.href='inbox.html'">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            <span class="sidebar__icon-badge" id="messagesBadge">0</span>
                        </button>
                        <button class="sidebar__icon-btn" id="notificationsBtn" aria-label="Notifications" onclick="window.location.href='notifications.html'">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                                <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                            </svg>
                            <span class="sidebar__icon-badge" id="notificationsBadge">0</span>
                        </button>
                    </div>
                </div>
                <nav class="sidebar__nav">
                    <a href="dashboard.html" class="sidebar__nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        <span>Tableau de bord</span>
                    </a>
                    <a href="covoiturages.html" class="sidebar__nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 17H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-1"></path>
                            <polygon points="12 15 17 21 7 21 12 15"></polygon>
                        </svg>
                        <span>Liste des covoiturages</span>
                    </a>
                    <a href="colocations.html" class="sidebar__nav-item sidebar__nav-item--active">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span>Liste des colocations</span>
                    </a>
                    <a href="profile.html" class="sidebar__nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        <span>My profile</span>
                    </a>
                    <a href="reviews.html" class="sidebar__nav-item">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        <span>Liste des reviews</span>
                    </a>
                </nav>
            </aside>

            <!-- Colocations Content -->
            <div class="dashboard-main">
                <div class="container">
                    <div class="colocations-section">
                        <div class="colocations-header">
                            <h1 class="colocations-title">Liste des colocations</h1>
                            <button class="btn btn--blue btn--propose" onclick="window.location.href='proposer-colocation.html'">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px; height: 20px; margin-right: 0.5rem;">
                                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                </svg>
                                Proposer une colocation
                            </button>
                        </div>
                        
                        <div class="colocations-filters">
                            <div class="filter-group">
                                <label for="searchLocation" class="filter-label">Localisation</label>
                                <input type="text" id="searchLocation" class="filter-input" placeholder="Ville, quartier...">
                            </div>
                            <div class="filter-group">
                                <label for="searchPrice" class="filter-label">Prix max (DT)</label>
                                <input type="number" id="searchPrice" class="filter-input" placeholder="Prix maximum" min="0">
                            </div>
                            <div class="filter-group">
                                <label for="searchRooms" class="filter-label">Chambres</label>
                                <select id="searchRooms" class="filter-input">
                                    <option value="">Toutes</option>
                                    <option value="1">1 chambre</option>
                                    <option value="2">2 chambres</option>
                                    <option value="3">3+ chambres</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="searchType" class="filter-label">Type</label>
                                <select id="searchType" class="filter-input">
                                    <option value="">Tous</option>
                                    <option value="appartement">Appartement</option>
                                    <option value="maison">Maison</option>
                                    <option value="studio">Studio</option>
                                </select>
                            </div>
                            <button class="btn btn--primary btn--search" id="searchBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                                Rechercher
                            </button>
                        </div>
                        
                        <div class="colocations-grid" id="colocationsGrid">
                            <!-- Les cards seront chargées dynamiquement -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer__content">
                <div class="footer__section footer__about">
                    <h3 class="footer__logo">/COLLOCOV</h3>
                    <p class="footer__description">
                        La plateforme qui connecte les étudiants pour la colocation et le covoiturage. 
                        Libère ton potentiel étudiant avec nous.
                    </p>
                </div>
                <div class="footer__section">
                    <h4 class="footer__title">Liens rapides</h4>
                    <ul class="footer__links">
                        <li><a href="index.html" class="footer__link">Acceuil</a></li>
                        <li><a href="#" class="footer__link">À propos</a></li>
                        <li><a href="#" class="footer__link">Contact</a></li>
                        <li><a href="#" class="footer__link">Tarifs</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h4 class="footer__title">Services</h4>
                    <ul class="footer__links">
                        <li><a href="#" class="footer__link">Colocation Étudiante</a></li>
                        <li><a href="#" class="footer__link">Covoiturage</a></li>
                        <li><a href="urgence.html" class="footer__link">Urgence</a></li>
                        <li><a href="#" class="footer__link">FAQ</a></li>
                    </ul>
                </div>
                <div class="footer__section">
                    <h4 class="footer__title">Contact</h4>
                    <ul class="footer__links">
                        <li><a href="mailto:contact@collocov.com" class="footer__link">contact@collocov.com</a></li>
                        <li><a href="tel:+33123456789" class="footer__link">+33 1 23 45 67 89</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer__bottom">
                <p class="footer__copyright">
                    &copy; 2024 COLLOCOV. Tous droits réservés.
                </p>
            </div>
        </div>
    </footer>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/main.js"></script>
    <script>
        // Données de colocations (simulées) avec coordonnées GPS
        const colocationsData = [
            {
                id: 1,
                title: 'Appartement moderne à Ariana',
                address: 'Ariana Soghra, Tunis',
                lat: 36.8625,
                lng: 10.1956,
                price: 350,
                rooms: 2,
                availableRooms: 1,
                type: 'appartement',
                owner: 'Marie Martin',
                description: 'Bel appartement proche de l\'ESPRIT, chambre disponible dans colocation étudiante',
                fullDescription: 'Cet appartement spacieux de 2 chambres est idéalement situé dans le quartier d\'Ariana Soghra, à seulement 10 minutes à pied de l\'ESPRIT. La chambre disponible est lumineuse, meublée et dispose d\'un grand placard. L\'appartement comprend un salon moderne, une cuisine équipée, une salle de bain partagée et un balcon avec vue. Le quartier est calme, sécurisé et bien desservi par les transports en commun. De nombreux commerces, restaurants et cafés sont à proximité.',
                amenities: ['WiFi', 'Chauffage', 'Meublé', 'Parking'],
                images: [
                    'https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1554995207-c18c203602cb?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1560448075-cbc16bb4af90?w=800&h=600&fit=crop'
                ]
            },
            {
                id: 2,
                title: 'Maison spacieuse à Lac',
                address: 'Lac 1, Tunis',
                lat: 36.8381,
                lng: 10.2408,
                price: 450,
                rooms: 3,
                availableRooms: 2,
                type: 'maison',
                owner: 'Pierre Dupont',
                description: 'Grande maison avec jardin, 2 chambres disponibles pour étudiants',
                fullDescription: 'Magnifique maison de 3 chambres avec jardin privé dans le quartier du Lac. Deux chambres sont disponibles pour des étudiants. La maison dispose d\'un grand salon, d\'une cuisine moderne entièrement équipée, de deux salles de bain et d\'un jardin aménagé parfait pour se détendre. Le quartier est résidentiel, calme et proche du lac de Tunis. Idéal pour les étudiants qui apprécient l\'espace et la tranquillité.',
                amenities: ['WiFi', 'Jardin', 'Meublé', 'Parking', 'Climatisation'],
                images: [
                    'https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1600607687939-ce8a6c25118c?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1600607687644-c7171b42498b?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1600566753190-17f0baa2a6c3?w=800&h=600&fit=crop'
                ]
            },
            {
                id: 3,
                title: 'Studio cosy à Manouba',
                address: 'Manouba Centre',
                lat: 36.8078,
                lng: 10.0972,
                price: 280,
                rooms: 1,
                availableRooms: 1,
                type: 'studio',
                owner: 'Sophie Bernard',
                description: 'Studio meublé et équipé, parfait pour un étudiant',
                fullDescription: 'Studio moderne et fonctionnel de 25m², entièrement meublé et équipé. Idéal pour un étudiant cherchant son indépendance. Le studio comprend une pièce principale avec coin cuisine intégré, une salle de bain privée et un grand placard. Situé au centre de Manouba, proche de l\'université et des commerces. Transport en commun facilement accessible.',
                amenities: ['WiFi', 'Meublé', 'Climatisation'],
                images: [
                    'https://images.unsplash.com/photo-1522771739844-6a9f6d5f14af?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1505693416388-ac5ce068fe85?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1556911220-bff31c812dba?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1556911220-e15b29be8c8f?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1560448075-cbc16bb4af90?w=800&h=600&fit=crop'
                ]
            },
            {
                id: 4,
                title: 'Appartement lumineux à Tunis Centre',
                address: 'Tunis Centre',
                lat: 36.8065,
                lng: 10.1815,
                price: 400,
                rooms: 2,
                availableRooms: 1,
                type: 'appartement',
                owner: 'Ahmed Ben Ali',
                description: 'Appartement bien situé, proche des transports en commun',
                fullDescription: 'Appartement lumineux de 2 chambres au cœur de Tunis. Une chambre est disponible dans cette colocation étudiante. L\'appartement bénéficie d\'une excellente exposition et d\'une vue dégagée. Il comprend un salon spacieux, une cuisine équipée, une salle de bain et un balcon. Situé dans le centre-ville, à proximité immédiate des transports en commun, des universités et de tous les commerces. Quartier animé et sécurisé.',
                amenities: ['WiFi', 'Chauffage', 'Meublé', 'Balcon'],
                images: [
                    'https://images.unsplash.com/photo-1505843513577-22bb7d21e455?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1502672260266-1c1ef2d93688?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1554995207-c18c203602cb?w=800&h=600&fit=crop',
                    'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop'
                ]
            }
        ];

        // Fonction pour initialiser une carte
        function initColocationMap(mapId, lat, lng, address) {
            const map = L.map(mapId, {
                zoomControl: false,
                attributionControl: false
            }).setView([lat, lng], 15);

            // Ajouter la couche de tuiles OpenStreetMap
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            // Marqueur de localisation
            const locationIcon = L.divIcon({
                className: 'custom-marker custom-marker--location',
                html: '<div class="marker-circle marker-circle--location"></div>',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            // Ajouter le marqueur
            L.marker([lat, lng], { icon: locationIcon }).addTo(map)
                .bindPopup(`<strong>${address}</strong>`);

            // Ajouter les contrôles de zoom
            L.control.zoom({
                position: 'topleft'
            }).addTo(map);

            return map;
        }

        // Vérifier si l'utilisateur est connecté
        document.addEventListener('DOMContentLoaded', function() {
            const currentUser = isLoggedIn();
            
            if (!currentUser) {
                alert('Vous devez être connecté pour accéder à cette page');
                window.location.href = 'connexion.html';
                return;
            }
            
            // Mettre à jour l'image de profil avec le nom de l'utilisateur
            const profileImg = document.getElementById('profileImg');
            if (profileImg) {
                const userName = currentUser.nom || 'User';
                profileImg.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=3B82F6&color=fff&size=128`;
            }
            
            // Mettre à jour l'image de profil dans la sidebar
            const sidebarProfileImg = document.getElementById('sidebarProfileImg');
            if (sidebarProfileImg) {
                const userName = currentUser.nom || 'User';
                sidebarProfileImg.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(userName)}&background=3B82F6&color=fff&size=128`;
            }
            
            // Afficher le nom de l'utilisateur dans la sidebar
            const sidebarUserName = document.getElementById('sidebarUserName');
            if (sidebarUserName) {
                sidebarUserName.textContent = currentUser.nom;
            }
            
            // Afficher le nom de l'utilisateur dans le dropdown
            const dropdownUserName = document.getElementById('dropdownUserName');
            if (dropdownUserName) {
                dropdownUserName.textContent = currentUser.nom;
            }
            
            // Gestion du menu déroulant du profil
            const profileBtn = document.getElementById('profileBtn');
            const profileDropdown = document.getElementById('profileDropdown');
            
            if (profileBtn && profileDropdown) {
                profileBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    profileDropdown.classList.toggle('active');
                });
                
                // Fermer le menu en cliquant ailleurs
                document.addEventListener('click', function(e) {
                    if (!profileBtn.contains(e.target) && !profileDropdown.contains(e.target)) {
                        profileDropdown.classList.remove('active');
                    }
                });
            }

            // Mettre en surbrillance l'élément actif dans la sidebar
            const currentPage = window.location.pathname.split('/').pop() || 'colocations.html';
            const navItems = document.querySelectorAll('.sidebar__nav-item');
            navItems.forEach(item => {
                const href = item.getAttribute('href');
                if (href === currentPage) {
                    item.classList.add('sidebar__nav-item--active');
                }
            });

            // Afficher les cards de colocations
            const colocationsGrid = document.getElementById('colocationsGrid');
            if (colocationsGrid) {
                colocationsGrid.innerHTML = colocationsData.map(colocation => {
                    const amenitiesHtml = colocation.amenities.map(amenity => 
                        `<span class="colocation-amenity">${amenity}</span>`
                    ).join('');

                    const typeLabel = {
                        'appartement': 'Appartement',
                        'maison': 'Maison',
                        'studio': 'Studio'
                    }[colocation.type] || colocation.type;

                    return `
                        <div class="colocation-card" onclick="window.location.href='details-colocation.html?id=${colocation.id}'" style="cursor: pointer;">
                            <div class="colocation-map">
                                <div class="map-container" id="map-${colocation.id}"></div>
                            </div>
                            <div class="colocation-info">
                                <div class="colocation-header-info">
                                    <div class="colocation-title-section">
                                        <h3 class="colocation-title">${colocation.title}</h3>
                                        <p class="colocation-address">
                                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 0.25rem;">
                                                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                                <circle cx="12" cy="10" r="3"></circle>
                                            </svg>
                                            ${colocation.address}
                                        </p>
                                    </div>
                                    <div class="colocation-price-section">
                                        <span class="colocation-price">${colocation.price} DT</span>
                                        <span class="colocation-price-period">/mois</span>
                                    </div>
                                </div>
                                <div class="colocation-details">
                                    <div class="colocation-detail-item">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                                        </svg>
                                        <span>${colocation.rooms} chambre${colocation.rooms > 1 ? 's' : ''}</span>
                                    </div>
                                    <div class="colocation-detail-item">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                        </svg>
                                        <span>${colocation.availableRooms} disponible${colocation.availableRooms > 1 ? 's' : ''}</span>
                                    </div>
                                    <div class="colocation-detail-item">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 18px; height: 18px;">
                                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        </svg>
                                        <span>${typeLabel}</span>
                                    </div>
                                </div>
                                <p class="colocation-description">${colocation.description}</p>
                                <div class="colocation-amenities">
                                    ${amenitiesHtml}
                                </div>
                                <div class="colocation-footer">
                                    <div class="colocation-owner">
                                        <img src="https://ui-avatars.com/api/?name=${encodeURIComponent(colocation.owner)}&background=10B981&color=fff&size=32" alt="${colocation.owner}" class="colocation-owner-img">
                                        <span class="colocation-owner-name">${colocation.owner}</span>
                                    </div>
                                    <a href="inbox.html" class="chat-link" onclick="event.stopPropagation();">Contacter</a>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');

                // Initialiser les cartes après un court délai pour s'assurer que les éléments sont dans le DOM
                setTimeout(() => {
                    colocationsData.forEach(colocation => {
                        const mapElement = document.getElementById(`map-${colocation.id}`);
                        if (mapElement) {
                            initColocationMap(
                                `map-${colocation.id}`,
                                colocation.lat,
                                colocation.lng,
                                colocation.address
                            );
                        }
                    });
                }, 100);
            }

            // Gestion de la recherche/filtre
            const searchBtn = document.getElementById('searchBtn');
            const searchLocation = document.getElementById('searchLocation');
            const searchPrice = document.getElementById('searchPrice');
            const searchRooms = document.getElementById('searchRooms');
            const searchType = document.getElementById('searchType');

            function filterColocations() {
                const locationValue = searchLocation.value.toLowerCase().trim();
                const priceValue = parseFloat(searchPrice.value) || 0;
                const roomsValue = searchRooms.value;
                const typeValue = searchType.value.toLowerCase();

                const cards = document.querySelectorAll('.colocation-card');
                let visibleCount = 0;

                cards.forEach(card => {
                    const addressText = card.querySelector('.colocation-address').textContent.toLowerCase();
                    const priceText = parseFloat(card.querySelector('.colocation-price').textContent);
                    const roomsText = card.querySelectorAll('.colocation-detail-item')[0].textContent;
                    const typeText = card.querySelectorAll('.colocation-detail-item')[2].textContent.toLowerCase();
                    
                    let shouldShow = true;

                    if (locationValue && !addressText.includes(locationValue)) {
                        shouldShow = false;
                    }
                    if (priceValue > 0 && priceText > priceValue) {
                        shouldShow = false;
                    }
                    if (roomsValue && !roomsText.includes(roomsValue)) {
                        shouldShow = false;
                    }
                    if (typeValue && !typeText.includes(typeValue)) {
                        shouldShow = false;
                    }

                    if (shouldShow) {
                        card.style.display = 'block';
                        visibleCount++;
                    } else {
                        card.style.display = 'none';
                    }
                });

                // Afficher un message si aucun résultat
                const grid = document.getElementById('colocationsGrid');
                const existingNoResults = grid.querySelector('.no-results');
                if (visibleCount === 0) {
                    if (!existingNoResults) {
                        const noResults = document.createElement('div');
                        noResults.className = 'no-results';
                        noResults.innerHTML = `
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                                <polyline points="9 22 9 12 15 12 15 22"></polyline>
                            </svg>
                            <p>Aucune colocation trouvée</p>
                        `;
                        grid.appendChild(noResults);
                    }
                } else {
                    if (existingNoResults) {
                        existingNoResults.remove();
                    }
                }
            }

            if (searchBtn) {
                searchBtn.addEventListener('click', filterColocations);
            }

            // Recherche en temps réel lors de la saisie
            if (searchLocation) {
                searchLocation.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        filterColocations();
                    }
                });
            }

            if (searchPrice) {
                searchPrice.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        filterColocations();
                    }
                });
            }
        });
    </script>
</body>
</html>

